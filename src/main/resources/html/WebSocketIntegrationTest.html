<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì´ëª¨ì§€ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h2>ğŸ”¥ ê²½ë§¤ ì´ëª¨ì§€ í…ŒìŠ¤íŠ¸</h2>
<div>
  <button onclick="connect()">1. ì—°ê²°í•˜ê¸°</button>
  <button onclick="sendEmoji('FIRE')">2. ğŸ”¥ ë¶ˆê½ƒ ì˜ê¸°</button>
  <button onclick="sendEmoji('LIKE')">3. ğŸ‘ ì¢‹ì•„ìš” ì˜ê¸°</button>
</div>
<hr/>
<h3>ğŸ“© ë°›ì€ ë©”ì‹œì§€ (êµ¬ë… í™”ë©´)</h3>
<div id="messages"></div>

<script>
  var stompClient = null;

  function connect() {
    // 1. ì—°ê²° ì£¼ì†Œ: WebSocketConfigì˜ addEndpoint ì£¼ì†Œ
    var socket = new SockJS('http://localhost:8080/ws-stomp');
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
      console.log('Connected: ' + frame);
      alert("ì—°ê²° ì„±ê³µ!");

      // 2. êµ¬ë… ì£¼ì†Œ: /topic/auction/{ê²½ë§¤ID}
      // (ê²½ë§¤ IDëŠ” 1ë²ˆì´ë¼ê³  ê°€ì •)
      stompClient.subscribe('/topic/auction/1', function (message) {
        showEmoji(JSON.parse(message.body));
      });
    });
  }

  function sendEmoji(type) {
    // 3. ì „ì†¡ ì£¼ì†Œ: /pub + ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ ì£¼ì†Œ
    // Configì—ì„œ "/pub" ì„¤ì •, Controllerì—ì„œ "/auctions/1/emoji" ì„¤ì •
    // => í•©ì³ì„œ "/pub/auctions/1/emoji"

    var payload = JSON.stringify({
      'emojiType': type
    });

    // í—¤ë”ì— userIdë¥¼ ë‹´ì•„ì„œ ë³´ëƒ„ (ìš°ë¦¬ê°€ ë§Œë“  ì„ì‹œ ë¡œì§)
    stompClient.send("/app/auctions/1/emoji", { 'userId': '1' }, payload);
  }

  function showEmoji(message) {
    var messagesDiv = document.getElementById("messages");
    var p = document.createElement("p");
    p.style.fontSize = "20px";
    // ì„œë²„ê°€ ë³´ë‚´ì¤€ ë©”ì‹œì§€ ì¶œë ¥
    p.textContent = `[ê²½ë§¤ë°© ${message.auctionId}] ${message.emojiType} ì´ëª¨ì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!`;
    messagesDiv.appendChild(p);
  }
</script>
</body>
</html>